# 容器生命周期

虽然 containerd 是一个提供管理多个容器的守护进程（daemon），但容器本身并不依赖于 containerd 的生命周期。每个容器都有一个 shim，作为容器进程的直接父进程，负责上报退出状态并持有容器的标准输入/输出（STDIO）。这也使得即便 containerd 崩溃，容器的所有功能仍能被恢复。

## containerd

该守护进程提供用于管理多个容器的 API。它可在必要时在进程内处理锁定，以协调子系统之间的任务。尽管守护进程会 fork 出运行容器所需的进程（例如 shim 与 runc），但这些进程会被重新归属为系统的 init（即成为 init 的子进程）。

## shim

每个容器都有自己的 shim，作为该容器进程的直接父进程。shim 负责保持容器的 IO 和/或 pty 主端（pty master）打开、为 containerd 写入容器的退出状态，并在容器进程退出时进行回收（reap）。由于 shim 持有容器的 pty 主端，它还提供用于调整终端尺寸的 API。

总体而言，容器的生命周期并不与 containerd 守护进程绑定。守护进程只是为多个容器提供管理 API，而每个容器的生命周期由对应的 shim 管理（每个容器对应一个 shim）。
